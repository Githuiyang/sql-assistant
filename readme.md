# 轻量SQL自动生成网页需求文档（最终版）
## 一、需求背景
运营、产品岗位日常工作中存在大量细碎数据查询需求，需通过SQL语句获取数据，但因开发/数据工程师资源紧张、响应不及时，此类小需求往往无法快速落地。为解决该痛点，拟开发一款开源轻量网页工具，依托大模型能力，让非技术岗用户自主完成字段关联识别与SQL生成，提升数据查询效率，无需依赖开发资源。

## 二、核心目标
1.  降低非技术岗用户数据查询门槛，无需依赖开发/数据工程师即可快速获取可用SQL
2.  基于上传的SQL与CSV文件，自动梳理表-字段关联关系，形成可复用字段字典
3.  支持多大模型切换，保证工具兼容性与灵活性，交互简洁丝滑，符合科技风设计标准
4.  开源轻量化设计，无需复杂配置，即开即用
## 三、功能需求

### （一）大模型配置模块（核心前置功能，新增）
1.  **配置优先级**：用户首次进入页面时，优先引导配置大模型和API密钥，完成配置后方可进行后续操作
2.  **支持的大模型**：
    - ChatGPT API (OpenAI)
    - Gemini API (Google)
    - 千问API (阿里云)
    - Kimi API (月之暗面)
    - 智谱API (清华)
3.  **API密钥验证**：
    - 用户输入API密钥后，自动进行有效性验证（发送简单测试请求）
    - 验证通过显示"连接成功"，失败显示明确错误提示（密钥无效、余额不足、网络错误等）
    - 支持保存API密钥到本地（加密存储），下次访问自动填充
    - 支持随时切换或更新API密钥
4.  **模型选择**：
    - 每个大模型支持选择具体模型版本（如gpt-4、gpt-3.5-turbo等）
    - 显示推荐模型（标注"推荐"标签）
    - 显示模型参数（token限制、价格信息提示）
5.  **配置入口**：
    - 首页设置卡片（置顶显示）
    - 顶部导航栏设置按钮
    - 字典生成、SQL生成页面快速配置入口

### （二）导入模块
1.  支持用户粘贴至少5段有效SQL代码，支持代码格式高亮、换行保留，支持复制粘贴直接导入
2.  支持上传5个与SQL代码一一对应的CSV表格文件，支持批量上传、单个上传，支持文件格式校验（仅允许CSV格式）
3.  文件大小限制：单个CSV文件上传大小严格限制在10MB以内，超出则提示文件过大并禁止上传
4.  导入前置提醒：导入环节明确弹窗提示两个核心信息，一是**务必上传已生效、可直接使用的SQL语句**，二是**本地历史数据7天内会自动完全清除**
5.  导入校验机制：若SQL段数与CSV文件数量不匹配、文件格式错误、文件超出大小限制，需给出明确提示，禁止进入下一步流程
6.  **依赖检查**：导入前检查是否已配置有效的大模型API密钥，未配置则引导用户先完成配置

### （三）字段字典生成模块
1.  导入完成后，触发大模型调用，基于上传的SQL代码（表结构、字段定义）和CSV表格（字段取值、数据类型），自动生成标准化字段字典
2.  字段字典核心内容：表名、字段名、字段数据类型、字段含义、表与表之间的关联关系、字段来源SQL对应关系、字段取值范围（取自CSV）
3.  字段字典完善补充功能：支持用户在线预览，支持手动编辑（修正字段含义、补充字段备注、调整表关联关系、完善字段取值说明），支持本地保存草稿，编辑后支持重新校验可用性
4.  字典预览功能：生成后支持在线预览、下载保存（支持CSV/Excel格式）
5.  可用性判断：大模型自动校验字典完整性（表、字段、关联关系无缺失），完成后给出“字典可用”提示；若信息缺失，提示用户补充上传SQL/CSV或手动完善字典
### （四）需求输入与SQL生成模块
1.  需求输入方式：支持用户手动输入自然语言需求（如"查询今日用户波动数据""统计过去7天新增付费用户明细"），支持需求内容保存、历史记录查询
2.  SQL生成规则（强制约束）：
    - 必须严格基于已生成的字段字典中的表、字段及关联关系进行编写
    - 禁止自行创建表、字段，禁止添加未在字典中定义的表关联、字段关联
    - 保证生成的SQL代码语法正确、逻辑通顺，可直接复制至数据工具（如Navicat、DBeaver）使用
3.  SQL校验功能：生成SQL后自动进行语法校验，校验通过提示"语法可用"；校验失败提示具体错误位置（如语法错误、字段不存在），支持用户手动调整
4.  SQL输出功能：生成后支持代码高亮、复制、一键下载，支持标注代码说明（字段含义、查询逻辑）
5.  **依赖检查**：SQL生成前检查是否已配置有效的大模型API密钥，未配置则引导用户先完成配置

### （五）导出模块
1.  支持字段字典导出（CSV/Excel格式，含编辑后最新内容）
2.  支持生成的SQL代码导出（TXT/CSV格式，含语法校验状态）
3.  支持用户操作历史（导入文件记录、需求记录、生成SQL记录）导出（不支持批量导出）

### （六）基础辅助功能
1.  历史记录管理：保存用户导入记录、字段字典记录、需求-SQL对应记录，支持按时间筛选、单个删除（不支持批量操作）
2.  历史数据清理：内置自动清理机制，所有本地历史数据（上传文件、操作记录、字典草稿）7天内自动完全清除，无残留
3.  容错机制（SQL相关）：用户上传SQL后先进行语法初步校验，若存在语法错误，**仅给出明确错误提示（标注错误位置），不自动修正**，提示用户更换生效可用的SQL重新上传
4.  操作提示：关键步骤（配置API、导入、生成字典、生成SQL）给出清晰文字/弹窗提示，异常情况（网络错误、API调用失败）给出可落地解决方案
5.  **配置管理**：保存用户的API密钥配置（加密存储），支持多套配置快速切换，支持配置导出/导入（便于多设备同步）
## 四、设计风格需求
1.  整体风格：严格遵循简单干净、科技风、简洁原则，界面元素少而精，避免冗余设计，契合开源轻量化定位
2.  动态交互：所有动态操作（文件上传进度、字典生成加载、SQL生成动画）需保证丝滑流畅，无卡顿、无延迟，加载状态有清晰反馈（进度条/加载动画）
3.  视觉细节：配色以科技感冷色调（深蓝、浅灰、白色）为主，支持主题切换（亮色/暗色）；字体清晰易读，代码区域高亮区分，操作按钮简洁直观

## 五、技术需求

### （一）用户使用流程（优化后）
1.  **首次访问**：
    - 打开网页 → 引导配置大模型 → 选择大模型提供商 → 输入API密钥 → 验证密钥有效性 → 保存配置（加密存储）
2.  **数据导入**：
    - 粘贴SQL代码（至少5段） → 上传CSV文件（至少5个） → 验证数据格式和数量 → 提交导入
3.  **生成字典**：
    - 系统自动调用已配置的大模型 → 分析SQL和CSV → 生成字段字典 → 在线预览/编辑 → 保存/导出
4.  **生成SQL**：
    - 输入自然语言需求 → 系统基于字典和需求调用大模型 → 生成SQL语句 → 语法校验 → 复制/下载

### （二）大模型接入相关
1.  **接入时机（3个关键节点）**
    - 时机0：用户首次进入时，配置并验证大模型API密钥
    - 时机1：用户完成SQL+CSV上传后，调用大模型生成字段字典
    - 时机2：用户输入自然语言需求后，调用大模型生成符合规则的SQL代码
2.  **支持的大模型API（用户可自选切换）**
    - ChatGPT API (OpenAI) - 推荐：gpt-4, gpt-3.5-turbo
    - Gemini API (Google)
    - 千问API (阿里云)
    - Kimi API (月之暗面)
    - 智谱API (清华)
3.  **API密钥验证机制**：
    - 输入密钥后发送简单测试请求（如"Hello"）验证有效性
    - 实时反馈验证结果（连接成功/密钥无效/余额不足/网络错误）
    - 验证通过后方可进行后续操作
4.  **配置管理要求**：
    - 预留所有大模型的API配置入口
    - 支持用户输入、切换、更新API密钥
    - 保存用户常用模型配置（本地加密存储）
    - 支持配置导出/导入（便于多设备同步）
5.  **异常处理**：
    - API调用失败（密钥错误、网络超时、额度不足）时，给出明确提示
    - 支持重试功能，支持重新配置API密钥

### （三）其他技术要求
1.  兼容性：支持主流浏览器（Chrome、Edge、Safari），适配电脑端（无需适配移动端）
2.  安全性：用户上传的文件、输入的API密钥仅本地缓存/临时存储，无后台长期留存，7天自动清理，保障数据隐私
3.  性能要求：文件上传、字典生成、SQL生成响应速度快，10MB以内CSV文件上传无明显卡顿
4.  开源适配：代码结构简洁，无复杂商业授权依赖，便于开源发布与个人二次修改

## 六、明确排除项（无需开发）
1.  无用户权限管理功能，无需登录即可直接使用
2.  无多人协作功能，不支持共享字段字典、协作编辑
3.  无批量操作功能，不支持批量删除历史记录、批量导出多份文件